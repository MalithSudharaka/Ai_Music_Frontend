"use client";

import React, { useEffect, useRef, useState } from "react";
import { gsap } from "gsap";
import { useGSAP } from "@gsap/react";

gsap.registerPlugin(useGSAP);

const Banner: React.FC<{ playAnimation: boolean }> = ({ playAnimation }) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [bannerCount, setBannerCount] = useState(0);

  useEffect(() => {
    calBannerCount();

    window.addEventListener("resize", calBannerCount);
    return () => window.removeEventListener("resize", calBannerCount);
  }, []);

  useGSAP(
    () => {
      const tl = gsap
        .timeline({
          paused: true,
        })
        .to("#banner-blue-container", {
          delay: 1,
          ease: "power1.in",
          opacity: 1,
          rotate: -3,
          y: 0,
        })
        .to(
          "#banner-white-container",
          {
            ease: "power1.in",
            opacity: 1,
            rotate: 3,
            y: 0,
          },
          "<+0.4",
        )
        .to(
          "#banner-white",
          {
            duration: 20,
            ease: "none",
            repeat: -1,
            xPercent: 0,
          },
          "<-0.4",
        )
        .to(
          "#banner-blue",
          {
            duration: 20,
            ease: "none",
            repeat: -1,
            xPercent: -50,
          },
          "<-0.4",
        );

      if (playAnimation) tl.play();
    },
    { scope: containerRef, dependencies: [playAnimation] },
  );

  const calBannerCount = () => {
    const windowW = window.innerWidth;
    let bannerImgW: number;

    if (windowW < 640) bannerImgW = Math.floor(windowW / (30 * 3));
    else if (windowW < 768) bannerImgW = Math.floor(windowW / (34.4 * 3));
    else if (windowW < 1024) bannerImgW = Math.floor(windowW / (38.8 * 3));
    else if (windowW < 1280) bannerImgW = Math.floor(windowW / (45.4 * 3));
    else if (windowW < 1536) bannerImgW = Math.floor(windowW / (52 * 3));
    else bannerImgW = Math.floor(windowW / (58.6 * 3));

    setBannerCount(bannerImgW);
  };

  return (
    <div ref={containerRef} className="relative z-[1] mt-[2em] sm:mt-0">
      {/* White banner */}
      <div
        id="banner-white-container"
        className="translate-y-1/4 overflow-x-clip bg-white opacity-0 shadow-[0.1em_0.1em_0.5em_rgba(0,0,0,0.4)] lg:absolute lg:right-0 lg:bottom-0 lg:left-0"
      >
        <div
          id="banner-white"
          className="grid h-[30px] w-[200%] -translate-x-1/2 grid-cols-2 sm:h-[34.4px] md:h-[38.8px] lg:h-[45.4px] xl:h-[52px] 2xl:h-[58.6px]"
        >
          {Array.from({ length: 2 }).map((_, i) => (
            <div key={i} className="flex justify-around">
              {Array.from({ length: bannerCount }).map((_, i) => (
                <div key={i} className="h-full">
                  <svg width="150" className="h-full" viewBox="0 0 150 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clipPath="url(#clip0_645_4243)">
                      <path d="M150 0H0V50H150V0Z" fill="white" />
                      <path d="M36.3828 26.1504C36.3828 27.6103 36.7011 28.6819 37.3379 29.3652C37.9746 30.0485 38.8517 30.3906 39.9697 30.3906C41.0879 30.3906 41.9658 30.0486 42.6025 29.3652C43.2392 28.6819 43.5576 27.6181 43.5576 26.1738V16.2266H47.1455V25.5684C47.1455 28.0531 46.5473 29.9553 45.3516 31.2754C44.1558 32.5799 42.3543 33.2323 39.9473 33.2324C37.5555 33.2324 35.7613 32.58 34.5654 31.2754C33.3852 29.9553 32.7949 28.0373 32.7949 25.5215V16.2266H36.3828V26.1504ZM55.749 15.9707C57.7057 15.9707 59.2669 16.4365 60.4316 17.3682C61.5964 18.2845 62.2568 19.5044 62.4121 21.0264H58.9639C58.8086 20.2032 58.428 19.5973 57.8223 19.209C57.2322 18.8209 56.4716 18.626 55.54 18.626C54.7325 18.626 54.0879 18.7822 53.6064 19.0928C53.125 19.4034 52.8838 19.8225 52.8838 20.3506C52.8838 20.7543 53.0163 21.1271 53.2803 21.4688C53.5443 21.7948 54.0953 22.0747 54.9336 22.3076L58.0557 23.1689C59.7019 23.6193 60.8823 24.2411 61.5967 25.0332C62.3265 25.8097 62.6914 26.7955 62.6914 27.9912C62.6914 29.6685 62.1091 30.9576 60.9443 31.8584C59.7795 32.7592 58.1563 33.21 56.0752 33.21C53.9012 33.2099 52.1619 32.7284 50.8574 31.7656C49.5528 30.7872 48.7916 29.4121 48.5742 27.6416H52.0225C52.1312 28.5423 52.5654 29.2571 53.3262 29.7852C54.0871 30.2976 55.0581 30.5537 56.2383 30.5537C57.2012 30.5537 57.9396 30.3827 58.4521 30.041C58.9798 29.6994 59.2441 29.2414 59.2441 28.667C59.2441 28.1235 59.0888 27.6884 58.7783 27.3623C58.4678 27.0207 57.9317 26.7488 57.1709 26.5469L54.0488 25.6855C52.4492 25.2352 51.2767 24.6212 50.5312 23.8447C49.8013 23.0527 49.4365 22.0661 49.4365 20.8857C49.4366 19.8765 49.6927 19.0072 50.2051 18.2773C50.7331 17.5319 51.4706 16.9644 52.418 16.5762C53.3652 16.1724 54.4757 15.9707 55.749 15.9707ZM21.4004 28.877L25.0469 16.2266H30.6611V33H27.1201V19.3301L23.1826 33H19.4795L15.5654 19.3945V33H12.1641V16.2266H17.7549L21.4004 28.877ZM76.584 18.9756H67.9648V23.0752H76.0479V25.7783H67.9648V30.251H76.8633V33H64.377V16.2266H76.584V18.9756ZM91.166 18.9756H82.5469V23.0752H90.6299V25.7783H82.5469V30.251H91.4453V33H78.959V16.2266H91.166V18.9756ZM99.9707 16.2266C101.85 16.2266 103.488 16.5687 104.886 17.252C106.284 17.9198 107.363 18.8826 108.124 20.1406C108.9 21.383 109.289 22.8581 109.289 24.5664C109.289 26.2747 108.901 27.7656 108.124 29.0391C107.348 30.2969 106.261 31.2757 104.863 31.9746C103.481 32.6579 101.858 33 99.9941 33H93.541V16.2266H99.9707ZM114.738 30.251H122.799V33H111.15V16.2266H114.738V30.251ZM137.098 18.9756H128.479V23.0752H136.562V25.7783H128.479V30.251H137.377V33H124.891V16.2266H137.098V18.9756ZM97.1289 30.2041H99.9707C101.182 30.2041 102.207 29.9638 103.046 29.4824C103.9 28.9854 104.545 28.3093 104.979 27.4551C105.43 26.6009 105.655 25.6221 105.655 24.5195C105.655 23.4326 105.438 22.4773 105.003 21.6543C104.568 20.8312 103.923 20.1866 103.069 19.7207C102.231 19.2548 101.198 19.0225 99.9707 19.0225H97.1289V30.2041Z" fill="black" />
                    </g>
                    <defs>
                      <clipPath id="clip0_645_4243">
                        <rect width="150" height="50" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>

                </div>
              ))}
            </div>
          ))}
        </div>
      </div>

      {/* Blue banner */}
      <div
        id="banner-blue-container"
        className="absolute right-0 bottom-0 left-0 translate-y-1/4 overflow-x-clip bg-primary opacity-0 shadow-[0.1em_0.1em_0.5em_rgba(0,0,0,0.4)]"
      >
        <div
          id="banner-blue"
          className="grid h-[30px] w-[200%] grid-cols-2 sm:h-[34.4px] md:h-[38.8px] lg:h-[45.4px] xl:h-[52px] 2xl:h-[58.6px]"
        >
          {Array.from({ length: 2 }).map((_, i) => (
            <div key={i} className="flex justify-around">
              {Array.from({ length: bannerCount }).map((_, i) => (
                <div key={i} className="h-full">
                  <svg width="150" className="h-full" viewBox="0 0 150 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clipPath="url(#clip0_645_4243)">
                      <path d="M150 0H0V50H150V0Z" fill="#EEB15C" />
                      <path d="M36.3828 26.1504C36.3828 27.6103 36.7011 28.6819 37.3379 29.3652C37.9746 30.0485 38.8517 30.3906 39.9697 30.3906C41.0879 30.3906 41.9658 30.0486 42.6025 29.3652C43.2392 28.6819 43.5576 27.6181 43.5576 26.1738V16.2266H47.1455V25.5684C47.1455 28.0531 46.5473 29.9553 45.3516 31.2754C44.1558 32.5799 42.3543 33.2323 39.9473 33.2324C37.5555 33.2324 35.7613 32.58 34.5654 31.2754C33.3852 29.9553 32.7949 28.0373 32.7949 25.5215V16.2266H36.3828V26.1504ZM55.749 15.9707C57.7057 15.9707 59.2669 16.4365 60.4316 17.3682C61.5964 18.2845 62.2568 19.5044 62.4121 21.0264H58.9639C58.8086 20.2032 58.428 19.5973 57.8223 19.209C57.2322 18.8209 56.4716 18.626 55.54 18.626C54.7325 18.626 54.0879 18.7822 53.6064 19.0928C53.125 19.4034 52.8838 19.8225 52.8838 20.3506C52.8838 20.7543 53.0163 21.1271 53.2803 21.4688C53.5443 21.7948 54.0953 22.0747 54.9336 22.3076L58.0557 23.1689C59.7019 23.6193 60.8823 24.2411 61.5967 25.0332C62.3265 25.8097 62.6914 26.7955 62.6914 27.9912C62.6914 29.6685 62.1091 30.9576 60.9443 31.8584C59.7795 32.7592 58.1563 33.21 56.0752 33.21C53.9012 33.2099 52.1619 32.7284 50.8574 31.7656C49.5528 30.7872 48.7916 29.4121 48.5742 27.6416H52.0225C52.1312 28.5423 52.5654 29.2571 53.3262 29.7852C54.0871 30.2976 55.0581 30.5537 56.2383 30.5537C57.2012 30.5537 57.9396 30.3827 58.4521 30.041C58.9798 29.6994 59.2441 29.2414 59.2441 28.667C59.2441 28.1235 59.0888 27.6884 58.7783 27.3623C58.4678 27.0207 57.9317 26.7488 57.1709 26.5469L54.0488 25.6855C52.4492 25.2352 51.2767 24.6212 50.5312 23.8447C49.8013 23.0527 49.4365 22.0661 49.4365 20.8857C49.4366 19.8765 49.6927 19.0072 50.2051 18.2773C50.7331 17.5319 51.4706 16.9644 52.418 16.5762C53.3652 16.1724 54.4757 15.9707 55.749 15.9707ZM21.4004 28.877L25.0469 16.2266H30.6611V33H27.1201V19.3301L23.1826 33H19.4795L15.5654 19.3945V33H12.1641V16.2266H17.7549L21.4004 28.877ZM76.584 18.9756H67.9648V23.0752H76.0479V25.7783H67.9648V30.251H76.8633V33H64.377V16.2266H76.584V18.9756ZM91.166 18.9756H82.5469V23.0752H90.6299V25.7783H82.5469V30.251H91.4453V33H78.959V16.2266H91.166V18.9756ZM99.9707 16.2266C101.85 16.2266 103.488 16.5687 104.886 17.252C106.284 17.9198 107.363 18.8826 108.124 20.1406C108.9 21.383 109.289 22.8581 109.289 24.5664C109.289 26.2747 108.901 27.7656 108.124 29.0391C107.348 30.2969 106.261 31.2757 104.863 31.9746C103.481 32.6579 101.858 33 99.9941 33H93.541V16.2266H99.9707ZM114.738 30.251H122.799V33H111.15V16.2266H114.738V30.251ZM137.098 18.9756H128.479V23.0752H136.562V25.7783H128.479V30.251H137.377V33H124.891V16.2266H137.098V18.9756ZM97.1289 30.2041H99.9707C101.182 30.2041 102.207 29.9638 103.046 29.4824C103.9 28.9854 104.545 28.3093 104.979 27.4551C105.43 26.6009 105.655 25.6221 105.655 24.5195C105.655 23.4326 105.438 22.4773 105.003 21.6543C104.568 20.8312 103.923 20.1866 103.069 19.7207C102.231 19.2548 101.198 19.0225 99.9707 19.0225H97.1289V30.2041Z" fill="black" />
                    </g>
                    <defs>
                      <clipPath id="clip0_645_4243">
                        <rect width="150" height="50" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>


                </div>
              ))}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default Banner;
